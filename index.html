<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisador e Editor de Imagem M&A AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#4F46E5',
                        'primary-purple': '#9333EA',
                        'dark-bg': '#0c0a09',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1f2937 0%, #0c0a09 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .crystal-card {
            background-color: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(79, 70, 229, 0.5);
            transition: all 0.3s ease;
        }
        .crystal-button {
            background: linear-gradient(90deg, #6366f1, #9333ea);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.5);
            transition: all 0.3s ease;
        }
        .crystal-button:hover {
            box-shadow: 0 6px 20px rgba(147, 51, 234, 0.7);
            transform: translateY(-2px);
        }
        .input-file-label {
            border: 2px dashed #4f46e5;
            background-color: rgba(79, 70, 229, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .input-file-label:hover {
            border-color: #9333ea;
            background-color: rgba(147, 51, 234, 0.2);
        }
        #result-area {
            min-height: 150px;
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #9333EA;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .citation {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 10px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
            padding-top: 5px;
        }
        .citation a {
            color: #6366f1;
            text-decoration: underline;
        }
        .star-rating {
            font-size: 1.2rem;
            line-height: 1;
            display: inline-block;
        }
        .star-rating .full-star {
            color: #FBBF24;
        }
        .star-rating .empty-star {
            color: #4B5563;
        }

        /* Container para a pr√©-visualiza√ß√£o da imagem editada */
        #edited-image-preview-container {
            width: 100%;
            max-width: 300px;
            aspect-ratio: 2/3;
            margin: 20px auto 0;
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden; 
            background-color: #333; 
            display: none;
        }

        #edited-image-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: brightness(0.7) blur(2px); 
        }
        
        #edited-image-object {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
            z-index: 1;
        }

        #edited-image-text-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.6), transparent);
            color: white;
            font-size: 0.9rem;
            text-align: center;
            backdrop-filter: blur(2px);
            /* Aumentado o espa√ßo para o texto */
            min-height: 100px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 2;
        }
        
        /* Nova classe para o conte√∫do estruturado - garante que o texto n√£o seja cortado */
        #edited-image-text-content {
            width: 90%;
            padding: 5px;
            white-space: normal; /* Permite que o texto quebre linhas */
            overflow: visible; /* Garante que o conte√∫do seja totalmente vis√≠vel */
            text-overflow: clip; /* Garante que n√£o haja retic√™ncias */
        }
        .overlay-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        .overlay-summary {
            font-size: 0.85rem;
            line-height: 1.3;
        }
    </style>
</head>
<body onload="initAuth()">

<div id="auth-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm transition-opacity duration-300">
    <div class="crystal-card p-6 sm:p-8 w-11/12 max-w-md rounded-2xl shadow-2xl text-center">
        <h2 class="text-2xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600">Acesso Restrito</h2>
        <p class="text-gray-300 mb-6">Insira a senha de acesso para continuar a an√°lise. A senha ser√° lembrada nesta sess√£o.</p>

        <input type="password" id="access-password" class="w-full p-3 mb-4 bg-black bg-opacity-30 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:ring-primary-blue focus:border-primary-blue transition" placeholder="Senha de Acesso" onkeyup="if(event.key === 'Enter') checkPassword()">
        
        <p id="password-error" class="text-red-400 text-sm mb-4 hidden">Senha incorreta. Tente novamente.</p>

        <button id="access-button" class="crystal-button w-full py-3 rounded-xl text-lg font-bold uppercase mb-4" onclick="checkPassword()">
            Acessar Analisador
        </button>

        <p class="text-sm text-gray-400 mt-4">
            N√£o possui a senha ou deseja registrar sua empresa?
            <a href="https://wa.me/5554993243670?text=Ol%C3%A1%21%20Gostaria%20de%20me%20registrar%20para%20ter%20acesso%20ao%20Analisador%20Cristalino." target="_blank" class="text-primary-purple font-semibold hover:text-pink-500 transition">
                Fale conosco pelo WhatsApp (55 54 993243670)
            </a>
        </p>
    </div>
</div>
<div id="app" class="w-full max-w-4xl p-6 md:p-10 crystal-card rounded-3xl text-white">

    <h1 class="text-3xl font-extrabold text-center mb-6 bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600">
        üíé avaliei M&A AI - An√°lise e Edi√ß√£o de Imagem üíé
    </h1>
    <p class="text-center text-sm mb-8 text-gray-300">
        Analise imagens, t√≠tulos de livros/links, e gere capas com edi√ß√£o simulada.
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <div class="space-y-6">
            <label for="image-input" class="input-file-label flex flex-col items-center justify-center p-4 rounded-xl h-28">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-blue mb-1" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                </svg>
                <span class="text-md font-semibold text-gray-200">Clique para Carregar Imagem (Capa ou Objeto)</span>
                <input type="file" id="image-input" accept="image/*" class="hidden" onchange="handleImageChange(event)">
            </label>
            
            <div id="image-display-area" class="bg-black bg-opacity-30 p-4 rounded-xl min-h-[150px] flex items-center justify-center border border-gray-700 relative">
                <img id="image-original-preview" class="max-h-48 object-contain rounded-lg shadow-2xl" src="" alt="Pr√©-visualiza√ß√£o da Imagem Original" style="display:none;">
                <p id="placeholder-text" class="text-gray-500">Nenhuma imagem selecionada/gerada.</p>
                
                <div id="edited-image-preview-container">
                    <div id="edited-image-bg"></div>
                    <img id="edited-image-object" src="" alt="Objeto Editado">
                    <div id="edited-image-text-overlay">
                        <div id="edited-image-text-content"></div> 
                    </div>
                </div>
            </div>
            
            <div>
                <label for="text-input" class="block text-sm font-medium text-gray-400 mb-2">Ou insira T√≠tulo de Livro / URL de Website:</label>
                <textarea id="text-input" class="w-full p-3 bg-black bg-opacity-30 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:ring-primary-blue focus:border-primary-blue transition" rows="3" placeholder="Ex: 'O Senhor dos An√©is' ou 'https://www.google.com'"></textarea>
            </div>

            <button id="analyze-button" class="crystal-button w-full py-3 rounded-xl text-lg font-bold uppercase disabled:opacity-50" onclick="analyzeContent()">
                Analisar
            </button>
        </div>

        <div class="space-y-6">
            <h2 class="text-xl font-bold text-primary-blue">
                ‚ú® Relat√≥rio da IA e Sugest√£o de Edi√ß√£o
            </h2>
            
            <div id="result-area" class="crystal-card p-6 rounded-xl text-gray-200 text-sm overflow-auto transition duration-500">
                <p>O resultado da an√°lise aparecer√° aqui.</p>
            </div>
            
            <button id="generate-button" class="crystal-button w-full py-3 rounded-xl text-lg font-bold uppercase hidden disabled:opacity-50" onclick="generateAndDownloadEditedImage()">
                üñºÔ∏è Baixar Imagem Editada (Simula√ß√£o)
            </button>

            <div id="loading-indicator" class="flex items-center justify-center hidden">
                <div class="loader mr-3"></div>
                <span class="text-lg text-primary-purple">Aguarde, a IA est√° processando...</span>
            </div>

            <div id="error-message" class="bg-red-900 bg-opacity-50 border border-red-700 p-3 rounded-lg text-red-200 text-sm hidden">
                Houve um erro na an√°lise. Tente novamente.
            </div>
        </div>

    </div>

</div>

<script>
    const MODEL_NAME = "gemini-2.5-flash-preview-09-2025";
    const API_KEY = "AIzaSyAJxkBsquPgfLxQZfFacA-Z4SAupnDW1Cc"; // Sua chave da API
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`; 
    
    const CORRECT_PASSWORD = 'sebosoler';
    const authModal = document.getElementById('auth-modal');
    const accessPasswordInput = document.getElementById('access-password');
    const passwordError = document.getElementById('password-error');

    const imageInput = document.getElementById('image-input');
    const imageOriginalPreview = document.getElementById('image-original-preview');
    const placeholderText = document.getElementById('placeholder-text');
    const analyzeButton = document.getElementById('analyze-button');
    const resultArea = document.getElementById('result-area');
    const loadingIndicator = document.getElementById('loading-indicator');
    const errorMessage = document.getElementById('error-message');
    const textInput = document.getElementById('text-input');
    const generateButton = document.getElementById('generate-button');
    
    // Novos elementos para a pr√©-visualiza√ß√£o da imagem "editada"
    const editedImagePreviewContainer = document.getElementById('edited-image-preview-container');
    const editedImageBg = document.getElementById('edited-image-bg');
    const editedImageObject = document.getElementById('edited-image-object');
    const editedImageTextOverlay = document.getElementById('edited-image-text-overlay');
    // Novo: Container estruturado
    const editedImageTextContent = document.getElementById('edited-image-text-content'); 

    let base64Image = null;
    let mimeType = '';
    let lastAnalysisText = ''; 
    let lastAnalysisTitle = 'Imagem_Editada'; 
    let currentObjectUrl = null; // Para manter o URL do objeto na pr√©via

    function getLevenshteinDistance(a, b) {
        if (a.length === 0) return b.length;
        if (b.length === 0) return a.length;
        const matrix = [];
        for (let i = 0; i <= b.length; i++) { matrix[i] = [i]; }
        for (let j = 0; j <= a.length; j++) { matrix[0][j] = j; }
        for (let i = 1; i <= b.length; i++) {
            for (let j = 1; j <= a.length; j++) {
                const cost = (b.charAt(i - 1) === a.charAt(j - 1)) ? 0 : 1;
                matrix[i][j] = Math.min(matrix[i - 1][j] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j - 1] + cost);
            }
        }
        return matrix[b.length][a.length];
    }
    function checkPassword() {
        passwordError.classList.add('hidden');
        const input = accessPasswordInput.value.toLowerCase().trim(); 
        const maxEditDistance = 1; 
        const distance = getLevenshteinDistance(input, CORRECT_PASSWORD);
        if (distance <= maxEditDistance) {
            sessionStorage.setItem('isAuthenticated', 'true');
            authModal.classList.add('hidden');
        } else {
            passwordError.classList.remove('hidden');
            accessPasswordInput.value = '';
            accessPasswordInput.focus();
        }
    }
    function initAuth() {
        const isAuthenticated = sessionStorage.getItem('isAuthenticated');
        if (isAuthenticated === 'true') {
            authModal.classList.add('hidden');
        } else {
            authModal.classList.remove('hidden');
            setTimeout(() => accessPasswordInput.focus(), 100); 
        }
    }
    
    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(file);
        });
    }

    async function handleImageChange(event) {
        errorMessage.classList.add('hidden');
        generateButton.classList.add('hidden');
        
        // Esconde as duas pr√©vias
        imageOriginalPreview.style.display = 'none';
        editedImagePreviewContainer.style.display = 'none';

        const file = event.target.files[0];
        
        if (file) {
            try {
                mimeType = file.type;
                base64Image = await fileToBase64(file);
                
                // Exibe a imagem original no preview do upload
                imageOriginalPreview.src = URL.createObjectURL(file);
                imageOriginalPreview.style.display = 'block';
                placeholderText.style.display = 'none';

                // Guarda o URL para usar no objeto editado
                if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl); // Libera o anterior
                currentObjectUrl = URL.createObjectURL(file);
                editedImageObject.src = currentObjectUrl; // Define o objeto para a pr√©via editada
                editedImageObject.style.display = 'block'; // Garante que o objeto est√° vis√≠vel no container editado
                
                resultArea.innerHTML = '<p class="text-gray-500">Imagem carregada. Clique em Analisar.</p>';
                textInput.value = ''; // Limpa o campo de texto
            } catch (error) {
                console.error("Erro ao processar o arquivo:", error);
                errorMessage.textContent = 'Erro ao carregar a imagem.';
                errorMessage.classList.remove('hidden');
            }
        } else {
            imageOriginalPreview.style.display = 'none';
            imageOriginalPreview.src = '';
            editedImageObject.style.display = 'none';
            if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl);
            currentObjectUrl = null;

            placeholderText.style.display = 'block';
            base64Image = null;
            mimeType = '';
            resultArea.innerHTML = '<p>O resultado da an√°lise aparecer√° aqui.</p>';
        }
    }
    
    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    /**
     * Fun√ß√£o para simular a edi√ß√£o e gerar a imagem com o texto de avalia√ß√£o.
     * Usa html2canvas para capturar a pr√©-visualiza√ß√£o "editada".
     */
    async function generateAndDownloadEditedImage() {
        if (!editedImagePreviewContainer || editedImagePreviewContainer.style.display === 'none') {
            alert("Nenhuma imagem editada para baixar. Fa√ßa uma an√°lise primeiro com uma imagem.");
            return;
        }

        generateButton.disabled = true;
        const originalButtonText = generateButton.textContent;
        generateButton.textContent = 'Gerando Imagem...';

        try {
            // Usa html2canvas para capturar o conte√∫do do container de pr√©-visualiza√ß√£o
            const canvas = await html2canvas(editedImagePreviewContainer, {
                allowTaint: true, // Permite imagens de outras origens (picsum, etc.)
                useCORS: true,   // Ativa o CORS para imagens externas
                scale: 2,         // Escala para melhor qualidade
                logging: false    // Desativa logs no console
            });

            // Cria um link para download
            const dataURL = canvas.toDataURL('image/png'); 
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = `${lastAnalysisTitle}_editado_ma_ai.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('Imagem editada baixada com sucesso! (Simula√ß√£o)');

        } catch (error) {
            console.error("Erro ao gerar a imagem para download:", error);
            alert("Erro ao baixar a imagem. Verifique o console para detalhes.");
        } finally {
            generateButton.textContent = originalButtonText;
            generateButton.disabled = false;
        }
    }


    async function analyzeContent() {
        if (sessionStorage.getItem('isAuthenticated') !== 'true') { authModal.classList.remove('hidden'); return; }

        const textQuery = textInput.value.trim();

        if (!base64Image && !textQuery) {
            resultArea.innerHTML = '<p class="text-yellow-400">Por favor, selecione uma imagem OU digite um texto/link para analisar.</p>';
            return;
        }

        analyzeButton.disabled = true;
        generateButton.classList.add('hidden');
        loadingIndicator.classList.remove('hidden');
        resultArea.innerHTML = '';
        errorMessage.classList.add('hidden');
        lastAnalysisText = ''; 
        editedImagePreviewContainer.style.display = 'none'; // Esconde a pr√©via editada enquanto processa

        // --- 1. CONFIGURA√á√ÉO DA INSTRU√á√ÉO E PROMPT PARA EDI√á√ÉO PROFISSIONAL ---
        const systemInstruction = `Voc√™ √© um avaliador e analista de IA M&A, especializado em livros, objetos e links.
Sua resposta deve ser em Portugu√™s do Brasil, concisa e estruturada em pontos.

Para QUALQUER entrada (imagem, livro, link), forne√ßa:
1.  **T√≠tulo/Objeto/Link**: Identifica√ß√£o principal do item.
2.  **P√°ginas/T√≥pico Principal**: N√∫mero de p√°ginas estimado (se livro) ou t√≥pico principal (se link/objeto).
3.  **Resumo R√°pido**: 1-2 frases sobre a hist√≥ria/fun√ß√£o/conte√∫do.
4.  **AVALIA√á√ÉO**: X/5 (use um n√∫mero de 1 a 5).

SE UMA IMAGEM FOR FORNECIDA, adicione um √∫ltimo ponto com o t√≠tulo **SUGEST√ÉO DE EDI√á√ÉO PROFISSIONAL:**.
Neste ponto, descreva como a imagem carregada seria profissionalmente editada para um uso de marketing ou capa, mantendo o objeto/livro, mas criando um fundo novo, iluminacao adequada e corrigindo erros da imagem. Seja criativo e descritivo.
Exemplo: "SUGEST√ÉO DE EDI√á√ÉO PROFISSIONAL: O livro seria isolado em um fundo abstrato com tons de azul e roxo, com luzes hologr√°ficas projetando-se sobre ele. Pequenas imperfei√ß√µes da capa seriam corrigidas, e a ilumina√ß√£o destacaria a textura."`;
        
        let userPrompt = '';
        const contents = [];

        if (base64Image) {
            userPrompt = `Analise esta imagem e forne√ßa a avalia√ß√£o e sugest√£o de edi√ß√£o profissional. ${textQuery ? 'O usu√°rio forneceu o contexto adicional: ' + textQuery : ''}`;
            contents.push({ role: "user", parts: [
                { text: userPrompt },
                { inlineData: { mimeType: mimeType, data: base64Image } }
            ]});
        } else if (textQuery) {
            userPrompt = `Analise o seguinte texto/link e forne√ßa a avalia√ß√£o solicitada: "${textQuery}"`;
            contents.push({ role: "user", parts: [{ text: userPrompt }] });
        } else {
            loadingIndicator.classList.add('hidden');
            analyzeButton.disabled = false;
            return; 
        }

        const payload = {
            contents: contents,
            tools: [{ "google_search": {} }], 
            systemInstruction: {
                parts: [{ text: systemInstruction }]
            },
        };
        
        const maxRetries = 3;
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                const candidate = result.candidates?.[0];
                const text = candidate?.content?.parts?.[0]?.text;

                if (text) {
                    lastAnalysisText = text; // Armazena a resposta bruta da IA
                    let processedText = text;

                    // Extrai T√≠tulo para o nome do arquivo de download
                    const titleMatch = text.match(/\*\*T√≠tulo\/Objeto\/Link\*\*\:\s*(.*?)\n/i);
                    if (titleMatch) {
                        lastAnalysisTitle = titleMatch[1].replace(/[^a-zA-Z0-9\s]/g, '').trim().replace(/\s+/g, '_');
                    } else {
                         lastAnalysisTitle = 'Imagem_Editada'; // Fallback
                    }

                    // 1. Processamento de Estrelas (busca por AVALIA√á√ÉO: X/5)
                    const starRegex = /AVALIA√á√ÉO:\s*(\d)\/5/i;
                    const match = text.match(starRegex);
                    
                    if (match) {
                        const score = parseInt(match[1], 10);
                        const fullStars = '‚òÖ'.repeat(Math.min(5, Math.max(0, score)));
                        const emptyStars = '‚òÜ'.repeat(5 - Math.min(5, Math.max(0, score)));
                        const starRatingHtml = `<span class="star-rating"><span class="full-star">${fullStars}</span><span class="empty-star">${emptyStars}</span></span>`;

                        processedText = text.replace(starRegex, `AVALIA√á√ÉO: ${starRatingHtml}`);
                    }
                    
                    // 2. Formata a resposta da IA (Markdown b√°sico para HTML)
                    let formattedText = processedText
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') 
                        .replace(/\n/g, '<br>');

                    resultArea.innerHTML = formattedText;
                    
                    // Se uma imagem foi carregada, atualiza a pr√©via de edi√ß√£o
                    if (base64Image) {
                        updateEditedImagePreview();
                        generateButton.classList.remove('hidden');
                    } else {
                        generateButton.classList.add('hidden'); // N√£o permite download se n√£o for imagem
                    }
                    
                    break; 

                } else {
                     throw new Error("Resposta da API vazia ou inv√°lida.");
                }

            } catch (error) {
                console.error(`Tentativa ${i + 1} falhou:`, error);
                if (i === maxRetries - 1) {
                    resultArea.innerHTML = 'Houve um erro inesperado. Verifique o console para detalhes.';
                    errorMessage.classList.remove('hidden');
                } else {
                    const delay = Math.pow(2, i) * 1000;
                    await sleep(delay);
                }
            } finally {
                if (i === maxRetries - 1 || resultArea.innerHTML !== '') {
                    loadingIndicator.classList.add('hidden');
                    analyzeButton.disabled = false;
                }
            }
        }
    }

    /**
     * Atualiza a pr√©-visualiza√ß√£o da imagem "editada" no container.
     */
    function updateEditedImagePreview() {
        if (!base64Image) {
            editedImagePreviewContainer.style.display = 'none';
            return;
        }

        // Fundo aleat√≥rio para simular "novo fundo" e "ilumina√ß√£o"
        editedImageBg.style.backgroundImage = `url('https://picsum.photos/seed/${Math.random()}/400/600')`;
        editedImageBg.style.display = 'block';

        editedImageObject.src = currentObjectUrl; // Objeto (livro/imagem original) centralizado
        editedImageObject.style.display = 'block';

        let title = "Item Analisado";
        let summary = "Resumo indispon√≠vel.";
        let scoreHtml = "";

        const lines = lastAnalysisText.split('\n');
        for (const line of lines) {
            if (line.includes('T√≠tulo/Objeto/Link')) {
                // Simplifica o t√≠tulo para caber no overlay
                title = line.split(':')[1].replace(/\*\*/g, '').trim().replace('de Gue Oliveira', '| Gue Oliveira');
            }
            if (line.includes('Resumo R√°pido')) {
                 // Remove '*' e ':' e trim
                 summary = line.split(':')[1].trim().replace(/^\s*-\s*/, '').replace(/\*\*/g, '');
            }
            // Processamento de Estrelas (busca por AVALIA√á√ÉO: X/5)
            const scoreMatch = line.match(/AVALIA√á√ÉO:\s*(\d)\/5/i);
            if (scoreMatch) {
                const score = parseInt(scoreMatch[1], 10);
                const fullStars = '‚òÖ'.repeat(Math.min(5, Math.max(0, score)));
                const emptyStars = '‚òÜ'.repeat(5 - Math.min(5, Math.max(0, score)));
                scoreHtml = `<span class="star-rating"><span class="full-star">${fullStars}</span><span class="empty-star">${emptyStars}</span></span>`;
            }
        }
        
        // Insere o conte√∫do estruturado em HTML
        editedImageTextContent.innerHTML = `
            <div class="overlay-title">${title}</div>
            <div class="overlay-summary">${summary}</div>
            <div class="mt-1">${scoreHtml}</div>
        `;


        // Exibe o container da imagem "editada" e oculta o preview original
        editedImagePreviewContainer.style.display = 'block';
        imageOriginalPreview.style.display = 'none';
        placeholderText.style.display = 'none';
    }


    document.addEventListener('DOMContentLoaded', () => {
        initAuth(); 
        
        textInput.addEventListener('input', () => {
             if (textInput.value.trim() !== '') {
                imageInput.value = '';
                handleImageChange({ target: { files: [] } }); 
             }
        });
    });

</script>

</body>
</html>
